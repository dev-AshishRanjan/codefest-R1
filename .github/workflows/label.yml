name: Directory-Based Labeler

on:
  pull_request:
    types: [opened]

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Label Pull Request
        uses: actions/github-script@v0.11.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          script: |
            const octokit = new github.GitHub(GITHUB_TOKEN);
            const pullRequestNumber = context.issue.number;
            const files = (await octokit.pulls.listFiles({ owner: context.repo.owner, repo: context.repo.repo, pull_number: pullRequestNumber })).data;
            let label = null;
            if (files.some(file => file.filename.startsWith('src/'))) {
              label = 'area: src';
            };
            else if (files.some(file => file.filename.startsWith('root/'))) {
              label = 'area: root';
            };
            else if ( files.some(file => file.filename.startsWith('package/'))) {
              label = 'area: package';
            };
            if (label) {
              octokit.issues.addLabels({ owner: context.repo.owner, repo: context.repo.repo, issue_number: pullRequestNumber, labels: [label]});
            };
